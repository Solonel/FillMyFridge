<lsc-back-menu></lsc-back-menu>

<div class="form justify-content-around">
    <div *ngIf="!isLoading">

        <form [formGroup]="categoryForm">
            <div class="container">
                <div class="row justify-content-around">

                    <div class="col-6">
                        <mat-slide-toggle formControlName="published"> Publié </mat-slide-toggle>
                    </div>
                    <div class="col-6">
                        <div formArrayName="recipes">
                            <mat-selection-list #recipesList>
                                <mat-list-option checkboxPosition="before" [value]="recipe.value" *ngFor="let recipe of recipeFormArray.controls; let idx = index"
                                    [formGroupName]="idx">
                                    <h3 matLine> {{recipe.value.title}} </h3>
                                    <p matLine>
                                        <span> {{recipe.value.description}} </span>
                                    </p>
                                    <p matLine>
                                        <span> Publié : </span>
                                        <i [ngClass]="{'fas fa-check-square':recipe.value.published,
                                            'far fa-square':!recipe.value.published}"></i>
                                    </p>
                                </mat-list-option>
                            </mat-selection-list>
                            <button type="button" *ngIf="recipeFormArray.controls.length > 0" (click)="removeRecipes(recipesList)" class="btn btn-dark">
                                Retirer recettes</button>
                            <!-- <button type="button" *ngIf="recipeFormArray.controls.length === 0" (click)="addRecipe()" class="btn btn-dark"> Ajouter recettes </button> -->
                        </div>
                    </div>
                    <div class="col-12">
                        <div *ngIf="categoryForm.value.id">
                            <button type="button" (click)="save()" class="btn btn-success"> Modifier </button>
                            <button type="button" (click)="delete()" class="btn btn-danger"> Supprimer </button>
                        </div>
                        <div *ngIf="!categoryForm.value.id">
                            <button (click)="addCategory()" type="button" class="btn btn-primary"> Enregistrer </button>
                        </div>
                    </div>
                </div>
            </div>
            <div formGroupName="locale">
                <mat-tab-group>
                    <mat-tab *ngFor="let language of categoryImplementedLanguages" formGroupName="{{language.id}}" label={{language.label}}>

                        <mat-form-field class="example-full-width">
                            <input type="text" class="text" matInput placeholder="title" formControlName='title'>
                        </mat-form-field>
                        <mat-form-field class="example-full-width">
                            <input type="text" class="text" matInput placeholder="description" formControlName='description'>
                        </mat-form-field>
                        <mat-form-field class="example-full-width">
                            <input type="text" class="text" matInput placeholder="available" formControlName='available'>
                        </mat-form-field>

                    </mat-tab>
                    <mat-tab label="Ajouter langue">
                        <mat-form-field class="example-full-width">
                            <mat-select placeholder="Langue" [(value)]="newLanguageId" (change)="newLanguageSelected(newLanguageId)">
                                <mat-option *ngFor="let language of categoryNotImplementedLanguages" [value]="language.id">
                                    {{ language.label }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>

                        <div formGroupName="{{newLanguageId}}" *ngIf="isFormReady">
                            <mat-form-field class="example-full-width">
                                <input type="text" class="text" matInput placeholder="title" formControlName='title'>
                            </mat-form-field>
                            <mat-form-field class="example-full-width">
                                <input type="text" class="text" matInput placeholder="description" formControlName='description'>
                            </mat-form-field>
                            <mat-form-field class="example-full-width">
                                <input type="text" class="text" matInput placeholder="available" formControlName='available'>
                            </mat-form-field>
                        </div>
                    </mat-tab>
                </mat-tab-group>
            </div>
        </form>
    </div>
</div>